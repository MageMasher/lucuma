<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Lucuma</title>
    <script src="assets/platform.min.js"></script>
    <script src="assets/spin.min.js"></script>
    <script src="assets/ladda.min.js"></script>
    <script src="assets/lucuma+tests.js"></script>
    <script src="http://code.jquery.com/jquery-2.0.3.min.js"></script>
    <script src="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/js/bootstrap.min.js"></script>
    <script src="assets/prism.js"></script>
    <script src="assets/prism.clojure.js"></script>
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="http://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css">
    <link rel="stylesheet" href="assets/prism.css">
    <link rel="stylesheet" href="assets/screen.css">
    <link rel="stylesheet" href="assets/ladda-themeless.min.css">
  </head>
  <body data-spy="scroll" data-target="#navbar">

    <a href="https://github.com/jeluard/lucuma">
      <img id="ribbon" src="http://aral.github.com/fork-me-on-github-retina-ribbons/right-dusk-blue@2x.png" alt="Fork me on GitHub">
    </a>
    <iframe id="github-button" src="http://ghbtns.com/github-btn.html?user=jeluard&repo=lucuma&type=watch&count=true"
allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
    <nav id="navbar" class="navbar navbar-default navbar-fixed-top" role="navigation">
      <div class="navbar-header">
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-ex1-collapse">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="#"><strong>LUCUMA</strong></a>
      </div>
      <div class="collapse navbar-collapse navbar-ex1-collapse">
        <ul class="nav navbar-nav">
          <li class="active"><a href="#introduction">Introduction</a></li>
          <li><a href="#installation">Installation</a></li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Usage <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="#custom-element-definition">Custom Element definition</a></li>
              <li><a href="#custom-element-lifecycle">Lifecycle</a></li>
              <li><a href="#custom-element-content">Content</a></li>
              <li><a href="#custom-element-style">Style</a></li>
              <li><a href="#custom-element-extend">Extending</a></li>
              <li><a href="#custom-element-methods">JavaScript Methods</a></li>
            </ul>
          </li>
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Examples <b class="caret"></b></a>
            <ul class="dropdown-menu">
              <li><a href="#example-range-with-threshold">Range with threshold</a></li>
              <li><a href="#example-autocompleter">Autocompleter</a></li>
              <li><a href="#example-overlay">Overlay</a></li>
              <li><a href="#example-flipbox">Flipbox</a></li>
              <li><a href="#example-todomvc">TodoMVC</a></li>
            </ul>
          </li>
          <li><a href="#tests">Tests</a></li>
          <li><a href="#native-browser-support">Native browser support</a></li>
          <li><a href="#links">Links</a></li>
        </ul>
      </div>
    </nav>
    
    <main class="container">
      <section id="introduction" class="main-section">
        <div class="lead">
          <p>A Web Components library for <a href="http://clojurescript.com">ClojureScript</a>.</p>
          <p>
            At its core lucuma helps with creating your own HTML element tag (Web Component) encapsulating content, style and logic. It is <strong>not</strong> a fancy <em>MV*</em> framework and aims at being a thin layer building on top of next generation web standards (mainly <span class="text-muted">Custom Elements</span>, <span class="text-muted">Shadow DOM</span> and <span class="text-muted">HTML Template</span>).
            <br>
            It also makes the extra effort of being flexible and open to existing ClojureScript standards and libraries.</p>
          <p>
            Lucuma is conceptually similar to <a href="http://www.polymer-project.org/">polymer</a>, <a href="http://www.x-tags.org/">x-tags</a> or <a href="https://www.dartlang.org/polymer-dart/">Polymer.dart</a>.
          </p>
        </div>
        <div class="disclaimer">
          <h4>Disclaimer</h4>
          <p>Technologies involved are pre-alpha (specs are not frozen yet). Use cautiously!</p>
        </div>
      </section>
    
      <section id="installation" class="main-section">
        <h1>Installation</h1>
        <p>Lucuma is available in <a href="https://clojars.org/lucuma">Clojars</a>. Add <strong>[lucuma "0.1.0"]</strong> dependency to your <strong>project.clj</strong>.</p>
        <div class="info">
          <h4>Browser support</h4>
          <p>Unless you target browsers with <a href="#native-browser-support">native</a> custom elements support you will need to use a polyfill.</p>
          <p>
            <a href="http://www.polymer-project.org/getting-the-code.html">Polymer</a> is one of the stronger alternative.
            Use it by adding <code class="language-markup">&lt;script src="platform.min.js"&gt;&lt;/script&gt;</code> to your html head (check <a href="http://www.polymer-project.org/build/">build reports</a> for browser support).
            </p>
        </div>
      </section>

      <section id="usage" class="main-section">
          <h1>Usage</h1>

          <section>
            <h2 id="custom-element-definition">Custom Element definition</h2>
            <p>
              Custom elements are defined as maps of keyword / value. The main keys available are :content, :style and 3 lifecyle related .
              This map serves as the abstract definition for the element prototype. Once registered the element can be manipulated by the DOM.
            </p>
            <div class="example-live">
              <ex-hello></ex-hello>
            </div>
            <pre class="example-markup">
              <code class="language-markup">
  &lt;ex-hello&gt;&lt;/ex-hello&gt;
              </code>
            </pre>
            <pre class="example-cljs">
              <code class="language-clojure">
  ;;First define your new element
  (use 'lucuma.custom-elements)
  (def m {:content "Hello world!")
  
  ;;then register it
  (register "ex-hello" m)
  
  ;;alternatively you can use the defwebcomponent macro

  (use 'lucuma)
  (defwebcomponent ex-hello
    :content "Hello World!")
  
  (register ex-hello)
              </code>
            </pre>
  
            <p>
             Custom Elements can be manipulated programmatically as any other regular element.
            </p>
            <pre class="example-cljs">
              <code class="language-clojure">
  ;;append a my-element node to body
  (.appendChild js/document.body (.createElement js/document "my-element"))
  
  ;;or using hiccup syntax and dommy
  (dommy/append! (dommy/sel1 :body) [:my-element])
              </code>
            </pre>
          </section>

          <section>
            <h2 id="custom-element-lifecycle">Lifecycle</h2>
            <p>Custom Elements define lifecycle callbacks that hook on element instance <strong>creation</strong>, view <strong>insertion</strong> and view <strong>removal</strong>.</p>
            <p>You can hook function to the element lifecycle using following keys:</p>
            <ul>
              <li><strong>created-fn</strong> called when an instance of the component is created (e.g. via <strong>document.createElement</strong>)</li>
              <li><strong>entered-view-fn</strong> called after an instance of the component entered the view (i.e. has been inserted)</li>
              <li><strong>left-view-fn</strong> called after an instance of the component left the view (i.e. has been removed)</li>
            </ul>
            <p>All functions receive as unique argument the element instance.</p>
            <div class="example-live">
              <script>
              var e;
              function createLifecycle() {
                e = document.createElement('ex-lifecycle');
                document.getElementById('btn-append').disabled = null;
                document.getElementById('btn-remove').disabled = "disabled";
              }
              function appendLifecycle() {
                document.body.appendChild(e);
                document.getElementById('btn-append').disabled = "disabled";
                document.getElementById('btn-remove').disabled = null;
              }
              function removeLifecycle() {
                document.body.removeChild(e);
                document.getElementById('btn-append').disabled = null;
                document.getElementById('btn-remove').disabled = "disabled";
              }
              </script>
              <div class="btn-group" style="float: left;">
                <button type="button" class="btn btn-default" onclick="createLifecycle()">Create</button>
                <button id="btn-append" type="button" class="btn btn-success" onclick="appendLifecycle()" disabled="disabled">Append</button>
                <button id="btn-remove" type="button" class="btn btn-danger" onclick="removeLifecycle()" disabled="disabled">Remove</button>
              </div>
              <ul id="lifecycle-events" style="height: 40px; width: 200px; overflow-y: auto;"></ul>
            </div>
            <pre class="example-cljs">
              <code class="language-clojure">
  (defwebcomponent ex-lifecycle
    :created-fn #(prepend! (sel1 :#lifecycle-events) [:li "element created"])
    :entered-view-fn #(prepend! (sel1 :#lifecycle-events) [:li "element entered view"])
    :left-view-fn #(prepend! (sel1 :#lifecycle-events) [:li "element left view"]))
              </code>
            </pre>
          </section>

          <section>
            <h2 id="custom-element-content">Content</h2>
            <p>
              Content of a Web Component comes the <strong>content</strong> value that will be rendered based on its type then inserted as a child of the element root node. This process is triggered per instance during <a href="#custom-element-lifecycle">creation phase</a>. For encapsulation purpoise content is inserted as a  Shadow DOM.
            </p>
            <p>The rendering process consists of:</p>
            <ol>
              <li>if content is a function evaluate it; otherwise use content value as-is</li>
              <li>call <a href="https://github.com/jeluard/lucuma/blob/master/src/lucuma/custom_elements.cljs#L15">render-content</a> multimethod (dispatch on content type) to generate the rendered html</li>
              <li>call <a href="https://github.com/jeluard/lucuma/blob/master/src/lucuma/custom_elements.cljs#L38">append!</a> multimethod (dispatch on rendered html type) to insert content in the DOM</li>
            </ol>
            <p>
            <p>
              <strong>render-content</strong> has implementations for String (identity) and <a href="#custom-element-template-support">HTML Template</a>.
              <br>
              <strong>append!</strong> has implementations for String (set as innerHTML), any HTMLElement and DocumentFragment (both inserted with appendChild).
            </p>
            <div class="example-live">
              <ex-hello></ex-hello>
            </div>
            <pre class="example-cljs">
              <code class="language-clojure">
  (defwebcomponent ex-hello
    :content "Hello world!")
              </code>
            </pre>
            <h4 id="custom-element-template-support">Template support</h4>            
            <p>
              <a href="http://docs.webplatform.org/wiki/html/elements/template">HTML template</a> can be directly used as content (its content will be cloned during <a href="#custom-element-lifecycle">creation phase</a>):
            </p>
            <div class="example-live">
              <template id="template-id">
                <div>Hello template!</div>
              </template>
              <ex-content-template></ex-content-template>
            </div>
            <pre class="example-markup">
              <code class="language-markup">
  &lt;template id="template-id"&gt;
    &lt;div&gt;Hello template!&lt;/div&gt;
  &lt;/template&gt;
  &lt;ex-content-template&gt;&lt;/ex-content-template&gt;
              </code>
            </pre>
            <pre class="example-cljs">
              <code class="language-clojure">
  (defwebcomponent ex-content-template
    :content #(dommy.macros/sel1 :#template-id))
              </code>
            </pre>
            <h4 id="custom-element-custom-logic">Custom logic support</h4>
            <p>
              As rendering is delegated to the render-content multimethod custom logic can be hooked. A common use-case is to use a <a href="https://github.com/weavejester/hiccup">hiccup</a> implementation (such as <a href="https://github.com/Prismatic/dommy">dommy</a>, <a href="https://github.com/ibdknox/crate/">crate</a>, <a href="https://github.com/lynaghk/singult">singult</a> or <a href="https://github.com/teropa/hiccups">hiccups</a>) to render vectors.
            </p>
            <div class="example-live">
              <ex-content-hiccup></ex-content-hiccup>
            </div>
            <pre class="example-cljs">
              <code class="language-clojure">
  ;; Use dommy.macros/node to render hiccup style vector as a DocumentFragment.
  
  (derive PersistentVector ::vector)
  (defmethod render-content ::vector [v] (node v))
  
  (defwebcomponent ex-content-hiccup
    :content [:div "Hello hiccup!"])
              </code>
            </pre>
          </section>

          <section>
            <h2 id="custom-element-style">Style</h2>
            <p>Style is treated similarly to <a href="custom-element-content">content</a>. Note that a single shadow DOM is created if one of <strong>content</strong> or <strong>style</strong> is defined.</p>
            <p>The rendering process consists of:</p>
            <ol>
              <li>if style is a function evaluate it; otherwise use style value as-is</li>
              <li>call <a href="https://github.com/jeluard/lucuma/blob/master/src/lucuma/custom_elements.cljs#L28">render-style</a> multimethod (dispatch on content type) to generate the rendered html</li>
              <li>call <a href="https://github.com/jeluard/lucuma/blob/master/src/lucuma/custom_elements.cljs#L38">append!</a> multimethod (dispatch on rendered html type) to insert content in the DOM</li>
            </ol>
            <p>
            <p>
              <strong>render-style</strong> has implementations for String (set as innerHTML of a newly created <strong>style</strong> element).
              <br>
              <strong>append!</strong> is the one used for <a href="custom-element-content">content</a> handling.
            </p>
            <div class="example-live">
              <ex-style></ex-style>
            </div>
            <pre class="example-cljs">
              <code class="language-clojure">
  (defwebcomponent ex-style
    :content "&lt;button&gt;Hello styled!&lt;/button&gt;"
    :style "button {background: blue; color: white; border: 0; border-radius: 4px;}")
              </code>
            </pre>
          </section>

          <section>
            <h2 id="custom-element-extend">Extension</h2>
            <p>
              Existing element can be extended to inherit capacity from another element (via prototype inheritence). <strong>base-type</strong> value must be a valid tag name. It defaults to HTMLElement.
            </p>
            <div class="example-live">
              <button is="ex-extend">Hello extended!</button>
            </div>
            <pre class="example-markup">
              <code class="language-markup">
  &lt;button is="ex-extend"&gt;Hello extended!&lt;/button&gt;
              </code>
            </pre>
            <pre class="example-cljs">
              <code class="language-clojure">
   (defwebcomponent ex-extend
    :base-type "button"
    :style "button {background: red;}")
              </code>
            </pre>
          </section>

          <section>
            <h2 id="custom-element-methods">JavaScript methods</h2>
            <p>
              Regular ClojureScript functions can directly manipulate element instances. You can also expose those functions to JavaScript users by explicitely listing those functions and assigning them a name that will be attached to the element prototype.
              <br>
              Note that ClojureScript functions will receive the right element instance as first parameter while you don't provide it JavaScript side.
            </p>
            <div class="example-live">
              <ex-methods id="ex-methods"></ex-methods>
              <button onclick="document.getElementById('ex-methods').alert()">Call alert</button>
            </div>
            <pre class="example-markup">
              <code class="language-markup">
  &lt;ex-methods id="ex-methods"&gt;&lt;/ex-methods&gt;
  &lt;button onclick="document.getElementById('ex-methods').alert()"&gt;Call alert&lt;/button&gt;
              </code>
            </pre>
            <pre class="example-cljs">
              <code class="language-clojure">
   (defn alert-fn
     [el]
     (.alert js/window (str "Hello " el " !")))

   (defwebcomponent ex-methods
    :methods {:alert alert-fn})
              </code>
            </pre>
          </section>

      </section>

      <section id="examples" class="main-section">
        <h1>Examples</h1>
        <p>All examples sources can be found <a href="https://github.com/jeluard/lucuma/tree/master/examples/lucuma">here</a>.</p>

        <section id="example-range-with-threshold">
          <h2>Range with threshold</h2>
          <div class="example-live">
            <input is="lucu-range-with-threshold" type="range" value="25" min="0" max="50" step="5" />
            <!--lucu-range-with-threshold type="range" value="25" min="0" max="50" step="5" /-->
          </div>
          <pre class="example-markup">
            <code class="language-markup">
            </code>
          </pre>
          <pre class="example-cljs">
            <code class="language-clojure">
            </code>
          </pre>
        </section>

        <section id="example-autocompleter">
          <h2>Autocompleter</h2>
          <p>Adpated from the excellent <a href="http://swannodette.github.io/2013/08/17/comparative/">post</a> from David Nolen</p>
          <div class="example-live">
          </div>
          <pre class="example-markup">
            <code class="language-markup">
            </code>
          </pre>
          <pre class="example-cljs">
            <code class="language-clojure">
            </code>
          </pre>
        </section>

        <section id="example-overlay">
          <h2>Overlay</h2>
          <p>Adpated from bee's <a href="https://github.com/blossom/bee/blob/master/lib/components/overlay.dart">overlay</a></p>
          <div class="example-live">
            <lucu-overlay id="overlay">
              <h4>Title</h4>
              <div>Some content</div>
            </lucu-overlay>
            <button onclick="document.getElementById('overlay').show()">Show overlay</button>
          </div>
          <pre class="example-markup">
            <code class="language-markup">
  &lt;lucu-overlay id="overlay"&gt;
    &lt;h4&gt;Title&lt;/h4&gt;
    &lt;div&gt;Some content&lt;/div&gt;
  &lt;/lucu-overlay&gt;
  &lt;button onclick="document.getElementById('overlay').show()">Show overlay&lt;/button&gt;
            </code>
          </pre>
          <pre class="example-cljs">
            <code class="language-clojure">
            </code>
          </pre>
        </section>

        <section>
          <h2 id="example-flipbox">Flipbox</h2>
          <p>Adpated from brick's <a href="https://github.com/x-tag/flipbox">flipbox</a></p>
          <em>TODO</em>
        </section>

        <section id="example-todomvc">
          <h2>TodoMVC</h2>
          <p>Lucuma based implementation of <a href="http://todomvc.com/">TodoMVC</a></p>
          <em>TODO</em>
        </section>

        <script>
          function fetchExample(id, name) {
            var selector = '#' + id + ' .example-cljs code';
            var example = document.querySelector(selector);
            if (example == null) {
              return;
            }

            var owner = "jeluard";
            var repo = "lucuma";
            var url_sha = "https://api.github.com/repos/" + owner + "/" + repo + "/contents/examples/lucuma/" + name + ".cljs";
            var xhr_sha = new XMLHttpRequest();
            xhr_sha.onreadystatechange = function() {
              if (xhr_sha.readyState == 4 && xhr_sha.status == 200) {
                var name = JSON.parse(xhr_sha.responseText).sha;
                var url = "https://api.github.com/repos/" + owner + "/" + repo + "/git/blobs/" + name;
                var xhr = new XMLHttpRequest();
                xhr.onreadystatechange = function() {
                  if (xhr.readyState == 4 && xhr.status == 200) {
                    example.innerHTML = window.atob(JSON.parse(xhr.responseText).content.replace(/\n/g, ""));
                  }
                };
                xhr.open("GET", url, true);
                xhr.send(null);
              }
            };
            xhr_sha.open("GET", url_sha, true);
            xhr_sha.send(null);
          }

          fetchExample("example-range-with-threshold", "range_with_threshold");
          fetchExample("example-autocompleter", "autocompleter");
          fetchExample("example-overlay", "overlay");
          fetchExample("example-flipbox", "flipbox");
          fetchExample("example-todomvc", "todomvc");
          Prism.highlightAll();
        </script>
      </section>

      <section id="tests" class="main-section" >
        <h1>Tests</h1>
        <script>
        function run_all_tests() {
          lucuma.test.browser_runner.run_all_tests();
        }
        </script>
        <button id="tests-btn" type="button" class="btn btn-primary ladda-button" data-style="expand-out" onclick="run_all_tests()">
          <span class="ladda-label">Run tests</span>
          <span class="ladda-spinner"></span>
        </button>
        <div id="tests-results"></div>
      </section>
    
      <section id="native-browser-support" class="main-section">
        <h1>Native browser support</h1>
        <p>
          Browsers are <a href="http://jonrimmer.github.io/are-we-componentized-yet/">implementing</a> Web Components technologies furiously those days. Still you have to enable their support manually.
        </p>
        <h3>Chrome Canary</h3>
        <p>Check chrome progress <a href="http://www.chromestatus.com/features">here</a>.</p>
        <p>Enable native Custom Elements support via the <a href="chrome://flags/#enable-experimental-web-platform-features">enable-experimental-web-platform-features</a> flag.</p>
      </section>

      <section id="links" class="main-section">
        <h1>Links</h1>

        <h3>Introdution</h3>
        <ul>
          <li><a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/explainer/index.html">W3C Introduction to Web Components</a></li>
          <li><a href="http://webcomponentsshift.com">webcomponentsshift.com</a></li>
          <li><a href="https://speakerdeck.com/stopsatgreen/web-components-getting-started">Getting started</a></li>
        </ul>

        <h3>Web Components library</h3>
        <ul>
          <li><a href="http://mozilla.github.io/brick/">Brick</a></li>
          <li><a href="http://registry.x-tags.org/">X-Tags</a></li>
          <li><a href="http://www.polymer-project.org/docs/elements/">Polymer</a></li>
          <li><a href="http://customelements.io/">CustomElements.io</a></li>
        </ul>

        <h3>To go further</h3>
        <ul>
          <li><a href="http://www.html5rocks.com/en/tutorials/webcomponents/customelements/">Custom Elements</a></li>
          <li><a href="http://www.html5rocks.com/en/tutorials/webcomponents/shadowdom/">Shadow DOM 101</a></li>
          <li><a href="http://www.html5rocks.com/en/tutorials/webcomponents/shadowdom-201/">Shadow DOM 201</a></li>
          <li><a href="http://www.html5rocks.com/en/tutorials/webcomponents/shadowdom-301/">Shadow DOM 301</a></li>
          <li><a href="http://www.html5rocks.com/en/tutorials/webcomponents/template/">Template</a></li>
        </ul>

        <h3>Specifications</h3>
        <ul>
          <li><a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/custom/index.html">Custom Elements</a></li>
          <li><a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/shadow/index.html">Shadow DOM</a></li>
          <li><a href="https://dvcs.w3.org/hg/webcomponents/raw-file/tip/spec/templates/index.html">HTML Template</a></li>
        </ul>

      </section>

      <script>
        document.addEventListener('DOMContentLoaded', function() {
          lucuma.examples.register_all();
        });
      </script>
    </main>

    <footer>
      Copyright © 2013 Julien Eluard - Distributed under the <a href="http://www.eclipse.org/legal/epl-v10.html">Eclipse Public License</a>, the same as Clojure.
    </footer>

  </body>
</html>